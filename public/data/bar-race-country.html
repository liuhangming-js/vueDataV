<!--
	此示例下载自 https://echarts.apache.org/examples/zh/editor.html?c=bar-race-country&code=MYewdgzgLgBArgBwCYEMoFMBiAndBHOdMYATxgF4YAmABjoG4AoUSWJASwFsiJ3wKYNJi2gxQcMFGwkAwiAA2IbBAEBvRjBgBBONGwp57FAC4YAcgDEdOgA4ARmYA0GmDJRgUqU5YBmdJy4yABbsHt4WPj5I6P7OmjJwdibmVjRUKDY-AZqYofLuSOF0AMwArDY02TA47sDo4ehIVACcxc1VAOLo2JzuJEWxLgCSdflghSklNs0A7FVD40bhPq1VAFIoCO7hdsB0VEhVZgBySlBBMADSSugoZkVUACw-KFRHAMogcOdXN3cDlTi5mO6AA7jAAFq3MaHAZPGaHIGnbCglD9FLoHxUOwHKoABQUBXCSGAAEZHsVgFUAEq6XjJSxIUrY0noKoAFTg2AA1uh0ZZ0MUaChSXMgWYAKpgdgYJBXUIAcyQIE490maUeCKOUpljRg7ygaHQEDVlhxVCoxUeZkYAF8mAASAB0oKCRAAFC5nQr0FA1u8APLHd1mIJQKAICDGAD00Ze0HkJCdACsINFDAA3bBOsC-6NgBCcaPoTggZPsAC0PnyCogAAFSU7ik6aNHUIaUxBwGYAJRA72-_1B93UgMB9kAfTxWnZAAkYABqcxttAoaMoCAQPPtteGHzoCvoAAeCHQwENxBIFcNdnk6E73Z7jB7TuVufdPgk574YBg7twEA0I4MAAaSPYwOomgiLA1YoLWAgATQADaNAALpMFB4CiDuCHGqSKHoS40EwCQtzKAISGEZoPhKH-d6wOwAhCDAjEADwwDuTp3mACrnPQi4Luw4GQZoLE-H-pEoMoXFELxFzkApggwAAPspJFkRASGSdJ3FyTAFYwKSqEwAAhIpO5IewqFIY8qHCS4onqVJEBOgguhBO6FlWTZdkYaJtouAF1FflAP4wD6UCYDW7riJI0jHCg3D2Y57Die6JmxVIJAJUlEEOaJuBQFyv5mGYfmaEFBW-sVf75dRNYuT4oRIB-IVhe6uqcMljlVUV2C_p1OaJegFCKZl8XDeV_ngapEGVZoL4lmW7B-ZV9EwNAUlQAs0RHgIpJCC462bdgUAAJpkQI2maSd23jMeVEwCACChfwlAiZoCrYOwEwfaJUDPaYB1Ao5dggOGKqmEKIOiXePhQEDpRAXVIHsAqYamBU-W2jDR5aEe7BRnlPUwL0R7eDuACyKBHlUjk04TAAyKB2Og8imH9jk0T0aAYNgpifsQr2_u6YDdSTmiFTV1PnE62BfOMovgUupVTY583-djMM7luCPEz1XZcnUpicRAhh1O6YFOk18h861QvtUg4s9VL_UcT5o2ULdF1SWrMC2k-6swyQ-OExzKNQCQp7eMARoKkoJB06JoQZt0W6mFIhAw5oZNA8jJMMxAzOs-z-skxAQQgKCGfYFnKPUeAUDvOwABe9SGY82eidzvTht0Attfw7oZgYhDOyTru_iP8iEIu5iqLBCrKWYc8RVFcHD6P6DK-YtplfX_td5L7DAEE4cS93Nbnxf3eN83bemFQpRHz1WxIBwPGmKUB8VQfGsVV3dwXA0A_gACJchAeAKGdBAHSl7mAiBwsJTICNNAmgWt8pbm-saUwSEUacyqgYUK3BPinRrnXC-WD2DGmZiQL4UAABC_JQAz04GAJOjlI7R3MEkbAHDk4YE4AaEgd5r4XxYUoAeDsh5bH0F1MuN9J5iAVllOQihlBIVkYlJ009CBIWKKhYys1LClE1DQYAAA2feN9_Z_xfkQUA0QxES3JhxLgPAfwv00OiYodiD75BLs48uldq4wEzugLxMAEC4GAITH8QNIkIBALwYW3hvroygPwxyuj0BaDgZAsA5CIk_xgDRSQmBErsETN4UsYBklbDqDaC-_9bGOVQjDWMMBQGExZneFi0pYBAPgeAJ0-UhkFPAfoVJggYbjOFpMgpyD2zt0QMsnA-BCCXlmfk4WABRDcipvCGFzFJJOcyfz7N4DxJZqDzDHLIknL6mwQjACCTANmJYiBQCJngi-BDOFR3bmYDAR5MmRPSRjQyFj843zBhDTgphoWROgCI9u_yeogr1t7MikSG6SG8GDeQ0RsAwAqAgPatT6koEabi0pVTS5mGwAqJIlsYGGTZQdICggnRPx7E0m-OMSktzzug5pKNULY0Cn5TpIgFD3kUAqd0z1hY9j8pwWQQQtpOl1gGF6P4lV6vAKqlw3M6K-hYgIW6O1jz8TYk5HSskfgGVJPxBcglnb22_EPISCjNC63ZO4-hnrhZ_nHqJVZRofbYHdNdSyc8jLGpJjjP8jEDJWvukecCAAqeAKCMDrIIA4kgibpodRLZVQWXrfwRowFGmNZFnbHS-NgOoAhTbm3QJbF8Ns7aVpDZ5MNSikAewUpQbSU0A5TWVT-bV3RqGaTQq-Vclrm11CnYasATonkIBeU6D53BJALtQtqyOd4nSYqumRKa6rghap1Rug1KrVp2lVUAA
	⚠ 请注意，该图表不是 Apache ECharts 官方示例，而是由用户代码生成的。请注意鉴别其内容。
-->
<!DOCTYPE html>
<html lang="zh-CN" style="height: 100%">
<head>
    <meta charset="utf-8">
</head>
<body style="height: 100%; margin: 0">
<div id="container" style="height: 100%"></div>

<script type="text/javascript" src="https://fastly.jsdelivr.net/npm/jquery"></script>
<script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
<!-- Uncomment this line if you want to dataTool extension
<script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.4.2/dist/extension/dataTool.min.js"></script>
-->
<!-- Uncomment this line if you want to use gl extension
<script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>
-->
<!-- Uncomment this line if you want to echarts-stat extension
<script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts-stat@latest/dist/ecStat.min.js"></script>
-->
<!-- Uncomment this line if you want to use map
<script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/china.js"></script>
<script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/world.js"></script>
-->
<!-- Uncomment these two lines if you want to use bmap extension
<script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_API_KEY"></script>
<script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.4.2/dist/extension/bmap.min.js"></script>
-->

<script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom, null, {
        renderer: 'canvas',
        useDirtyRect: false
    });
    var app = {};
    var ROOT_PATH = 'https://echarts.apache.org/examples';
    var option;

    const updateFrequency = 2000;
    const dimension = 0;
    const countryColors = {
        Australia: '#00008b',
        Canada: '#f00',
        China: '#ffde00',
        Cuba: '#002a8f',
        Finland: '#003580',
        France: '#ed2939',
        Germany: '#000',
        Iceland: '#003897',
        India: '#f93',
        Japan: '#bc002d',
        'North Korea': '#024fa2',
        'South Korea': '#000',
        'New Zealand': '#00247d',
        Norway: '#ef2b2d',
        Poland: '#dc143c',
        Russia: '#d52b1e',
        Turkey: '#e30a17',
        'United Kingdom': '#00247d',
        'United States': '#b22234'
    };
    $.when(
        $.getJSON('https://fastly.jsdelivr.net/npm/emoji-flags@1.3.0/data.json'),
        $.getJSON(ROOT_PATH + '/data/asset/data/life-expectancy-table.json')
    ).done(function (res0, res1) {
        const flags = res0[0];
        const data = res1[0];
        const years = [];
        for (let i = 0; i < data.length; ++i) {
            if (years.length === 0 || years[years.length - 1] !== data[i][4]) {
                years.push(data[i][4]);
            }
        }

        function getFlag(countryName) {
            if (!countryName) {
                return '';
            }
            return (
                flags.find(function (item) {
                    return item.name === countryName;
                }) || {}
            ).emoji;
        }

        let startIndex = 10;
        let startYear = years[startIndex];
        option = {
            grid: {
                top: 10,
                bottom: 30,
                left: 150,
                right: 80
            },
            xAxis: {
                max: 'dataMax',
                axisLabel: {
                    formatter: function (n) {
                        return Math.round(n) + '';
                    }
                }
            },
            dataset: {
                source: data.slice(1).filter(function (d) {
                    return d[4] === startYear;
                })
            },
            yAxis: {
                type: 'category',
                inverse: true,
                max: 10,
                axisLabel: {
                    show: true,
                    fontSize: 14,
                    formatter: function (value) {
                        return value + '{flag|' + getFlag(value) + '}';
                    },
                    rich: {
                        flag: {
                            fontSize: 25,
                            padding: 5
                        }
                    }
                },
                animationDuration: 300,
                animationDurationUpdate: 300
            },
            series: [
                {
                    realtimeSort: true,
                    seriesLayoutBy: 'column',
                    type: 'bar',
                    itemStyle: {
                        color: function (param) {
                            return countryColors[param.value[3]] || '#5470c6';
                        }
                    },
                    encode: {
                        x: dimension,
                        y: 3
                    },
                    label: {
                        show: true,
                        precision: 1,
                        position: 'right',
                        valueAnimation: true,
                        fontFamily: 'monospace'
                    }
                }
            ],
            // Disable init animation.
            animationDuration: 0,
            animationDurationUpdate: updateFrequency,
            animationEasing: 'linear',
            animationEasingUpdate: 'linear',
            graphic: {
                elements: [
                    {
                        type: 'text',
                        right: 160,
                        bottom: 60,
                        style: {
                            text: startYear,
                            font: 'bolder 80px monospace',
                            fill: 'rgba(100, 100, 100, 0.25)'
                        },
                        z: 100
                    }
                ]
            }
        };
        // console.log(option);
        myChart.setOption(option);
        for (let i = startIndex; i < years.length - 1; ++i) {
            (function (i) {
                setTimeout(function () {
                    updateYear(years[i + 1]);
                }, (i - startIndex) * updateFrequency);
            })(i);
        }

        function updateYear(year) {
            let source = data.slice(1).filter(function (d) {
                return d[4] === year;
            });
            option.series[0].data = source;
            option.graphic.elements[0].style.text = year;
            myChart.setOption(option);
        }
    });


    if (option && typeof option === 'object') {
        myChart.setOption(option);
    }

    window.addEventListener('resize', myChart.resize);
</script>
</body>
</html>